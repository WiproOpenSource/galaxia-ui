
module.exports = function(app) {
	
	  app.get('/dashboard/chartdata/:dashboardname/:widget/:index', function(req, res, next) {
 
                                var data =[[1370131200000,0.9695],[1370217600000,0.9648],[1370304000000,0.9645],[1370390400000,0.9638],[1370476800000,0.9549],[1370563200000,0.9562],[1370736000000,0.9574],[1370822400000,0.9543],[1370908800000,0.951],[1370995200000,0.9498],[1371081600000,0.9477],[1371168000000,0.9492],[1371340800000,0.9487],[1371427200000,0.948],[1371513600000,0.9466],[1371600000000,0.9521],[1371686400000,0.9564],[1371772800000,0.9621],[1371945600000,0.963],[1372032000000,0.9623],[1372118400000,0.9644],[1372204800000,0.9685],[1372291200000,0.9671],[1372377600000,0.9687],[1372550400000,0.9687],[1372636800000,0.9654],[1372723200000,0.9705],[1372809600000,0.9687],[1372896000000,0.9744],[1372982400000,0.9793],[1373155200000,0.9804],[1373241600000,0.977],[1373328000000,0.9824],[1373414400000,0.9705],[1373500800000,0.9635],[1373587200000,0.9652],[1373760000000,0.9656],[1373846400000,0.9655],[1373932800000,0.9598],[1374019200000,0.9619],[1374105600000,0.9628],[1374192000000,0.9609],[1374364800000,0.9599],[1374451200000,0.9584],[1374537600000,0.9562],[1374624000000,0.9575],[1374710400000,0.9531],[1374796800000,0.953],[1374969600000,0.9526],[1375056000000,0.954],[1375142400000,0.954],[1375228800000,0.9518],[1375315200000,0.9571],[1375401600000,0.9529],[1375574400000,0.9532],[1375660800000,0.9542],[1375747200000,0.9515],[1375833600000,0.9498],[1375920000000,0.9473],[1376006400000,0.9494],[1376179200000,0.9497],[1376265600000,0.9519],[1376352000000,0.954],[1376438400000,0.9543],[1376524800000,0.9492],[1376611200000,0.9502],[1376784000000,0.9503],[1376870400000,0.9499],[1376956800000,0.9453],[1377043200000,0.9487],[1377129600000,0.9487],[1377216000000,0.9472],[1377388800000,0.9471],[1377475200000,0.948],[1377561600000,0.9467],[1377648000000,0.9497],[1377734400000,0.9552],[1377820800000,0.9562],[1377993600000,0.9572],[1378080000000,0.9581],[1378166400000,0.9593],[1378252800000,0.9571],[1378339200000,0.9622],[1378425600000,0.9588],[1378598400000,0.9591],[1378684800000,0.9544],[1378771200000,0.9537],[1378857600000,0.9512],[1378944000000,0.9519],[1379030400000,0.9522],[1379203200000,0.9486],[1379289600000,0.95],[1379376000000,0.9486],[1379462400000,0.9396],[1379548800000,0.9391],[1379635200000,0.9394],[1379808000000,0.9389],[1379894400000,0.9411],[1379980800000,0.9422],[1380067200000,0.9393],[1380153600000,0.9413],[1380240000000,0.9396],[1380412800000,0.941],[1380499200000,0.9393],[1380585600000,0.9393],[1380672000000,0.9365],[1380758400000,0.9343],[1380844800000,0.9376],[1381017600000,0.937],[1381104000000,0.9362],[1381190400000,0.9368],[1381276800000,0.9393],[1381363200000,0.9397],[1381449600000,0.9385],[1381622400000,0.9377],[1381708800000,0.9374],[1381795200000,0.9395],[1381881600000,0.9389],[1381968000000,0.9312],[1382054400000,0.9307],[1382227200000,0.9309],[1382313600000,0.9308],[1382400000000,0.9256],[1382486400000,0.9258],[1382572800000,0.9247],[1382659200000,0.9244],[1382832000000,0.9244],[1382918400000,0.9255],[1383004800000,0.9275],[1383091200000,0.928],[1383177600000,0.9361],[1383264000000,0.9415],[1383436800000,0.9411],[1383523200000,0.9399],[1383609600000,0.9421],[1383696000000,0.94],[1383782400000,0.9452],[1383868800000,0.9479],[1384041600000,0.9492],[1384128000000,0.946],[1384214400000,0.9442],[1384300800000,0.9415],[1384387200000,0.9429],[1384473600000,0.941],[1384646400000,0.9417],[1384732800000,0.9405],[1384819200000,0.9386],[1384905600000,0.9441],[1384992000000,0.9418],[1385078400000,0.9376],[1385251200000,0.9379],[1385337600000,0.9399],[1385424000000,0.9369],[1385510400000,0.9365],[1385596800000,0.935],[1385683200000,0.9358],[1385856000000,0.9362],[1385942400000,0.9385],[1386028800000,0.9359],[1386115200000,0.9357],[1386201600000,0.9317],[1386288000000,0.9297],[1386460800000,0.9296],[1386547200000,0.9279],[1386633600000,0.9267],[1386720000000,0.9254],[1386806400000,0.927],[1386892800000,0.9276],[1387065600000,0.9278],[1387152000000,0.9267],[1387238400000,0.9263],[1387324800000,0.9307],[1387411200000,0.9319],[1387497600000,0.9315],[1387670400000,0.9311],[1387756800000,0.9301],[1387843200000,0.9308],[1387929600000,0.931],[1388016000000,0.9304],[1388102400000,0.9277],[1388275200000,0.9272],[1388361600000,0.9244],[1388448000000,0.9275],[1388534400000,0.9271],[1388620800000,0.9314],[1388707200000,0.9359],[1388880000000,0.9355],[1388966400000,0.9338],[1389052800000,0.9345],[1389139200000,0.9366],[1389225600000,0.9349],[1389312000000,0.9316],[1389484800000,0.9315],[1389571200000,0.9315],[1389657600000,0.931],[1389744000000,0.935],[1389830400000,0.9341],[1389916800000,0.9385],[1390089600000,0.9392],[1390176000000,0.9379],[1390262400000,0.9373],[1390348800000,0.9381],[1390435200000,0.9301],[1390521600000,0.9311],[1390694400000,0.9306],[1390780800000,0.9314],[1390867200000,0.9316],[1390953600000,0.9319],[1391040000000,0.9377],[1391126400000,0.9415],[1391299200000,0.9414],[1391385600000,0.9393],[1391472000000,0.9397],[1391558400000,0.9389],[1391644800000,0.9358],[1391731200000,0.9334],[1391904000000,0.9343],[1391990400000,0.9328],[1392076800000,0.9332],[1392163200000,0.9356],[1392249600000,0.9309],[1392336000000,0.9304],[1392508800000,0.93],[1392595200000,0.9295],[1392681600000,0.9268],[1392768000000,0.9281],[1392854400000,0.9289],[1392940800000,0.9278],[1393113600000,0.928],[1393200000000,0.928],[1393286400000,0.9275],[1393372800000,0.9306],[1393459200000,0.9295],[1393545600000,0.9245],[1393718400000,0.9259],[1393804800000,0.928],[1393891200000,0.9276],[1393977600000,0.9282],[1394064000000,0.9215],[1394150400000,0.9206],[1394323200000,0.9206],[1394409600000,0.9207],[1394496000000,0.9216],[1394582400000,0.9192],[1394668800000,0.921],[1394755200000,0.9187],[1394928000000,0.9188],[1395014400000,0.9183],[1395100800000,0.9177],[1395187200000,0.9229],[1395273600000,0.9258],[1395360000000,0.9249],[1395532800000,0.9247],[1395619200000,0.9226],[1395705600000,0.9232],[1395792000000,0.9255],[1395878400000,0.9278],[1395964800000,0.9271],[1396137600000,0.9272],[1396224000000,0.9261],[1396310400000,0.925],[1396396800000,0.9264],[1396483200000,0.9289],[1396569600000,0.9298],[1396742400000,0.9298],[1396828800000,0.9278],[1396915200000,0.9248],[1397001600000,0.9218],[1397088000000,0.92],[1397174400000,0.9202],[1397347200000,0.9222],[1397433600000,0.9236],[1397520000000,0.9239],[1397606400000,0.9238],[1397692800000,0.9238],[1397779200000,0.9238],[1397952000000,0.9239],[1398038400000,0.925],[1398124800000,0.9244],[1398211200000,0.9238],[1398297600000,0.9229],[1398384000000,0.9229],[1398556800000,0.9226],[1398643200000,0.922],[1398729600000,0.924],[1398816000000,0.9211],[1398902400000,0.921],[1398988800000,0.9209],[1399161600000,0.9209],[1399248000000,0.9207],[1399334400000,0.918],[1399420800000,0.9188],[1399507200000,0.9225],[1399593600000,0.9268],[1399766400000,0.9267],[1399852800000,0.9269],[1399939200000,0.9297],[1400025600000,0.9291],[1400112000000,0.9294],[1400198400000,0.9302],[1400371200000,0.9298],[1400457600000,0.9295],[1400544000000,0.9298],[1400630400000,0.9307],[1400716800000,0.9323],[1400803200000,0.9335],[1400976000000,0.9338],[1401062400000,0.9329],[1401148800000,0.9335],[1401235200000,0.9358],[1401321600000,0.9351],[1401408000000,0.9337],[1401580800000,0.9338],[1401667200000,0.9355],[1401753600000,0.9338],[1401840000000,0.9353],[1401926400000,0.9321],[1402012800000,0.933],[1402185600000,0.9327],[1402272000000,0.9356],[1402358400000,0.9381],[1402444800000,0.9389],[1402531200000,0.9379],[1402617600000,0.9384],[1402790400000,0.9388],[1402876800000,0.9367],[1402963200000,0.9382],[1403049600000,0.9356],[1403136000000,0.9349],[1403222400000,0.9353],[1403395200000,0.9357],[1403481600000,0.935],[1403568000000,0.935],[1403654400000,0.9337],[1403740800000,0.9347],[1403827200000,0.9327],[1404000000000,0.933],[1404086400000,0.9304],[1404172800000,0.931],[1404259200000,0.932],[1404345600000,0.9347],[1404432000000,0.9356],[1404604800000,0.936],[1404691200000,0.935],[1404777600000,0.9346],[1404864000000,0.9329],[1404950400000,0.9348],[1405036800000,0.9349],[1405209600000,0.9352],[1405296000000,0.9342],[1405382400000,0.9369],[1405468800000,0.9393],[1405555200000,0.9392],[1405641600000,0.9394],[1405814400000,0.939],[1405900800000,0.9395],[1405987200000,0.9427],[1406073600000,0.9427],[1406160000000,0.9428],[1406246400000,0.9446],[1406419200000,0.9447],[1406505600000,0.944],[1406592000000,0.9458],[1406678400000,0.9464],[1406764800000,0.9469],[1406851200000,0.9446],[1407024000000,0.9447],[1407110400000,0.945],[1407196800000,0.9477],[1407283200000,0.9472],[1407369600000,0.9483],[1407456000000,0.9457],[1407628800000,0.946],[1407715200000,0.947],[1407801600000,0.948],[1407888000000,0.9482],[1407974400000,0.9482],[1408060800000,0.9463],[1408233600000,0.9469],[1408320000000,0.9483],[1408406400000,0.9508],[1408492800000,0.9541],[1408579200000,0.9529],[1408665600000,0.9551],[1408838400000,0.9577],[1408924800000,0.958],[1409011200000,0.9593],[1409097600000,0.958],[1409184000000,0.9585],[1409270400000,0.9614],[1409443200000,0.9618],[1409529600000,0.9618],[1409616000000,0.9614],[1409702400000,0.9604],[1409788800000,0.9725],[1409875200000,0.9722],[1410048000000,0.9721],[1410134400000,0.9753],[1410220800000,0.973],[1410307200000,0.9742],[1410393600000,0.9736],[1410480000000,0.9713],[1410652800000,0.9717],[1410739200000,0.9727],[1410825600000,0.9716],[1410912000000,0.9772],[1410998400000,0.9739],[1411084800000,0.9794],[1411257600000,0.9788],[1411344000000,0.9782],[1411430400000,0.9784],[1411516800000,0.9824],[1411603200000,0.9843],[1411689600000,0.9884],[1411862400000,0.9891],[1411948800000,0.9883],[1412035200000,0.9916],[1412121600000,0.9922],[1412208000000,0.9893],[1412294400000,0.9989],[1412467200000,0.9992],[1412553600000,0.9903],[1412640000000,0.9893],[1412726400000,0.9853],[1412812800000,0.988],[1412899200000,0.9919],[1413072000000,0.9912],[1413158400000,0.9842],[1413244800000,0.99],[1413331200000,0.979],[1413417600000,0.9806],[1413504000000,0.9835],[1413676800000,0.9844],[1413763200000,0.9813],[1413849600000,0.9864],[1413936000000,0.9905],[1414022400000,0.9907],[1414108800000,0.9893],[1414281600000,0.9889],[1414368000000,0.9875],[1414454400000,0.9853],[1414540800000,0.9916],[1414627200000,0.9929],[1414713600000,0.9984],[1414886400000,0.9999],[1414972800000,0.5012],[1415059200000,0.9971],[1415145600000,0.5009],[1415232000000,0.5081],[1415318400000,0.503],[1415491200000,0.5025],[1415577600000,0.5051],[1415664000000,0.5016],[1415750400000,0.504],[1415836800000,0.5015],[1415923200000,0.9985],[1416096000000,0.9988],[1416182400000,0.5032],[1416268800000,0.9976],[1416355200000,0.9965],[1416441600000,0.9975],[1416528000000,0.5071],[1416700800000,0.5082],[1416787200000,0.5037],[1416873600000,0.5016],[1416960000000,0.9996],[1417046400000,0.5022],[1417132800000,0.5031],[1417305600000,0.504],[1417392000000,0.502],[1417478400000,0.5075],[1417564800000,0.5123],[1417651200000,0.5078],[1417737600000,0.5139],[1417910400000,0.5135],[1417996800000,0.5119],[1418083200000,0.5081],[1418169600000,0.5034],[1418256000000,0.5057],[1418342400000,0.5024],[1418515200000,0.5024],[1418601600000,0.504],[1418688000000,0.9993],[1418774400000,0.5102],[1418860800000,0.5139],[1418947200000,0.5177],[1419120000000,0.518],[1419206400000,0.5176],[1419292800000,0.5215],[1419379200000,0.52],[1419465600000,0.5182],[1419552000000,0.5213],[1419724800000,0.5218],[1419811200000,0.5229],[1419897600000,0.5225],[1419984000000,0.5266],[1420070400000,0.5262],[1420156800000,0.5331],[1420329600000,0.5371],[1420416000000,0.538],[1420502400000,0.5411],[1420588800000,0.5447],[1420675200000,0.548],[1420761600000,0.5445],[1420934400000,0.5425],[1421020800000,0.5451],[1421107200000,0.5495],[1421193600000,0.5482],[1421280000000,0.5598],[1421366400000,0.5643],[1421539200000,0.5648],[1421625600000,0.5617],[1421712000000,0.5658],[1421798400000,0.5613],[1421884800000,0.5798],[1421971200000,0.5922],[1422144000000,0.599],[1422230400000,0.5898],[1422316800000,0.5787],[1422403200000,0.5859],[1422489600000,0.5834],[1422576000000,0.5859],[1422748800000,0.5843],[1422835200000,0.5817],[1422921600000,0.571],[1423008000000,0.5813],[1423094400000,0.5713],[1423180800000,0.5837],[1423353600000,0.5839],[1423440000000,0.5831],[1423526400000,0.5833],[1423612800000,0.5823],[1423699200000,0.577],[1423785600000,0.5783],[1423958400000,0.5774],[1424044800000,0.5807],[1424131200000,0.5762],[1424217600000,0.5774],[1424304000000,0.5798],[1424390400000,0.5787],[1424563200000,0.5787],[1424649600000,0.5824],[1424736000000,0.5818],[1424822400000,0.5801],[1424908800000,0.5931],[1424995200000,0.5932],[1425168000000,0.596],[1425254400000,0.5941],[1425340800000,0.5948],[1425427200000,0.9026],[1425513600000,0.9066],[1425600000000,0.9222],[1425772800000,0.9221],[1425859200000,0.9214],[1425945600000,0.9347],[1426032000000,0.9482],[1426118400000,0.9403],[1426204800000,0.9528],[1426377600000,0.9541],[1426464000000,0.9462],[1426550400000,0.9435],[1426636800000,0.9203],[1426723200000,0.9381],[1426809600000,0.9241],[1426982400000,0.9237],[1427068800000,0.9135],[1427155200000,0.9152],[1427241600000,0.9114],[1427328000000,0.9188],[1427414400000,0.9184],[1427587200000,0.9188],[1427673600000,0.9231],[1427760000000,0.9319],[1427846400000,0.9291],[1427932800000,0.9188],[1428019200000,0.9109],[1428192000000,0.9091],[1428278400000,0.9154],[1428364800000,0.9246],[1428451200000,0.9276],[1428537600000,0.9382],[1428624000000,0.9431],[1428796800000,0.9426],[1428883200000,0.9463],[1428969600000,0.9386],[1429056000000,0.9357],[1429142400000,0.9293],[1429228800000,0.9254],[1429401600000,0.9251],[1429488000000,0.9312],[1429574400000,0.9315],[1429660800000,0.9323],[1429747200000,0.9236],[1429833600000,0.9196],[1430006400000,0.9201],[1430092800000,0.9184],[1430179200000,0.9106],[1430265600000,0.5983],[1430352000000,0.5909],[1430438400000,0.5928],[1430611200000,0.5941],[1430697600000,0.5972],[1430784000000,0.594],[1430870400000,0.5808],[1430956800000,0.5876],[1431043200000,0.5925],[1431216000000,0.5934],[1431302400000,0.5964],[1431388800000,0.5917],[1431475200000,0.5805],[1431561600000,0.5764],[1431648000000,0.5732],[1431820800000,0.5737],[1431907200000,0.5838],[1431993600000,0.5969],[1432080000000,0.9014],[1432166400000,0.5999],[1432252800000,0.9076],[1432425600000,0.9098],[1432512000000,0.911],[1432598400000,0.9196],[1432684800000,0.917],[1432771200000,0.9133],[1432857600000,0.9101],[1433030400000,0.9126],[1433116800000,0.9151],[1433203200000,0.5965],[1433289600000,0.5871],[1433376000000,0.5898],[1433462400000,0.5999],[1433635200000,0.9004],[1433721600000,0.5857],[1433808000000,0.5862],[1433894400000,0.5829],[1433980800000,0.5882],[1434067200000,0.5873],[1434240000000,0.5913],[1434326400000,0.5862],[1434412800000,0.5891],[1434499200000,0.5821],[1434585600000,0.5802],[1434672000000,0.5808],[1434844800000,0.5794],[1434931200000,0.5818],[1435017600000,0.5952],[1435104000000,0.5924],[1435190400000,0.5925],[1435276800000,0.5955],[1435449600000,0.9113],[1435536000000,0.59],[1435622400000,0.595]];
                                                var set = parseInt(req.params.index); console.log(req.params.index);
                                                var filtervalue=[];
                                               // for(i=set;i<set;i++) {
                                                                               filtervalue.push({x:data[set][0],y:data[set][1]});
                                                                               console.log(data[set]);
                                              //  }
                                                res.send([{
																name:"Label1",
																value: filtervalue,
																widget:req.params.widget,
																dashboard:req.params.dashboardname
															  },{
																name:"Label2",
																value: filtervalue,
																widget:req.params.widget,
																dashboard:req.params.dashboardname
															  }])
													});

	app.get('/getdashboards/', function(req, res, next) {
		res.redirect("/dashboard/templates/");
	});

	app.get('/dashboard/metrics/:appname', function(req, res, next) {
		var metric = app.get('metric');
		var condition = {name:req.params.appname};
		var fields = {};
		condition.where ={};  
		fields = 
					{'_id':0};

				metric.find(condition,fields,null,function(err,result){ 
					if(err)
						console.log("Error is : " +  err);
					else{
						var results = [];
						for(i in result){						
					    	results.push(result[i]);
					    }
						res.send(result);								
						}
				});
	});	                                      

	app.post('/savedashboard/', function(req, res, next) {
    	res.redirect(307,'/dashboard/templatecreate/');
	});

	app.post('/dashboard/createmetrics/', function(req, res, next) {
		console.log("inside create metrics");
		var metric = app.get('metric');
		var attributes = {}
		attributes = {appname:req.body.widgets, metrics: req.body.metrics}; 
		console.log("template is "+JSON.stringify(attributes));
		
		metric.save(attributes,function(err,result){ 
			if(err){
			console.log(err+"error");
				next(err);}
			else {
				res.send(result);
			}
		});
	});

	app.post('/updatedashboard/', function(req, res, next) {
    	res.redirect(307,'/dashboard/templatesave/');
	});

	app.post('/dashboard/updatemetrics/', function(req, res, next) {
		console.log("inside update metrics");
		var metric = app.get('metric');
		var condition = {};
		condition = {appname:req.body.widgets};		
		var attributes = {}
		attributes = {metrics: req.body.metrics}; 
		//console.log("template is "+JSON.stringify(attributes));
		
		metric.update(condition,attributes,function(err,result){ 
			if(err){
				console.log(err+"error");
				next(err);}
			else {
				res.send(result);
			}
		});
	});

	app.delete('/deletedashboard/:dbname', function(req, res, next) {
		res.redirect('/dashboard/remove/'+req.params.dbname);
	});

	
}